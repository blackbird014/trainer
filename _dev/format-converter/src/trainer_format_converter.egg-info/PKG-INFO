Metadata-Version: 2.4
Name: trainer-format-converter
Version: 0.1.0
Summary: Format conversion system supporting Markdown, HTML, PDF, JSON with auto-detection and schema-aware conversion
Author: Trainer Project
License: MIT
Keywords: format,conversion,markdown,html,pdf,json,schema
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: markdown>=3.4.0
Requires-Dist: weasyprint>=60.0
Requires-Dist: jinja2>=3.1.0
Requires-Dist: prometheus-client>=0.19.0
Requires-Dist: fastapi>=0.104.0
Requires-Dist: uvicorn[standard]>=0.24.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: pytest-mock>=3.10.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Provides-Extra: pydantic
Requires-Dist: pydantic>=2.0.0; extra == "pydantic"
Provides-Extra: latex
Requires-Dist: pypandoc>=1.11; extra == "latex"
Provides-Extra: docx
Requires-Dist: python-docx>=1.0.0; extra == "docx"
Provides-Extra: all
Requires-Dist: pytest>=7.0.0; extra == "all"
Requires-Dist: pytest-cov>=4.0.0; extra == "all"
Requires-Dist: pytest-mock>=3.10.0; extra == "all"
Requires-Dist: black>=23.0.0; extra == "all"
Requires-Dist: ruff>=0.1.0; extra == "all"
Requires-Dist: pydantic>=2.0.0; extra == "all"
Requires-Dist: pypandoc>=1.11; extra == "all"
Requires-Dist: python-docx>=1.0.0; extra == "all"

# Format Converter

A Python module providing format conversion between Markdown, HTML, PDF, and JSON with auto-detection and schema-aware conversion.

## Features

- **Multi-Format Support**: Markdown, HTML, PDF, JSON
- **Auto-Detection**: Automatically detect input format (MD vs JSON)
- **Schema-Aware Conversion**: Use schemas to guide JSON → MD conversion
- **Bidirectional Conversion**: MD ↔ JSON round-trip support
- **Structured Output Support**: Handle LLM JSON responses gracefully
- **Template Support**: Apply HTML templates and CSS styling
- **Prometheus Metrics**: Built-in metrics for monitoring

## Installation

### Basic Installation

```bash
pip install -e .
```

### With Optional Dependencies

```bash
# Pydantic for schema validation
pip install -e ".[pydantic]"

# LaTeX support
pip install -e ".[latex]"

# DOCX support
pip install -e ".[docx]"

# All optional dependencies
pip install -e ".[all]"
```

## Quick Start

### Markdown to HTML

```python
from format_converter import FormatConverter

converter = FormatConverter()
md = "# Title\n\nThis is **bold** text."
html = converter.convert(md, source_format="markdown", target_format="html")
```

### JSON to Markdown

```python
json_data = {
    "report": {
        "title": "Analysis",
        "sections": {
            "summary": "Key findings",
            "details": ["Detail 1", "Detail 2"]
        }
    }
}

md = converter.convert(json_data, source_format="json", target_format="markdown")
```

### Auto-Detection

```python
# Auto-detect format
content = '{"key": "value"}'  # JSON string
html = converter.convert(content, source_format="auto", target_format="html")
```

### Markdown to PDF

```python
pdf_bytes = converter.convert(md, source_format="markdown", target_format="pdf")
with open("output.pdf", "wb") as f:
    f.write(pdf_bytes)
```

## API Service

The module includes a FastAPI service for exposing format conversion via REST API:

```bash
cd _dev/format-converter
python api_service.py
```

The service runs on port 8004 (configurable via `PORT` environment variable) and provides:

- `GET /` - API information
- `GET /health` - Health check
- `POST /detect` - Detect format of content
- `POST /convert` - Convert content between formats
- `GET /metrics` - Prometheus metrics endpoint

### Example API Usage

```bash
# Detect format
curl -X POST http://localhost:8004/detect \
  -H "Content-Type: application/json" \
  -d '{"content": "# Title\n\nContent"}'

# Convert Markdown to HTML
curl -X POST http://localhost:8004/convert \
  -H "Content-Type: application/json" \
  -d '{
    "content": "# Title\n\nContent",
    "source_format": "markdown",
    "target_format": "html"
  }'

# Convert JSON to Markdown (auto-detect)
curl -X POST http://localhost:8004/convert \
  -H "Content-Type: application/json" \
  -d '{
    "content": {"key": "value"},
    "source_format": "auto",
    "target_format": "markdown"
  }'
```

## Prometheus Metrics

The module exposes Prometheus metrics at `/metrics` endpoint:

- `format_converter_operations_total` - Total conversions (by source_format, target_format, status)
- `format_converter_operation_duration_seconds` - Conversion duration histogram
- `format_converter_data_size_bytes` - Converted data size histogram
- `format_converter_errors_total` - Total errors (by source_format, target_format, error_type)
- `format_converter_auto_detections_total` - Auto-detection operations (by detected_format)

### Monitoring Setup

1. **Start the API service**:
   ```bash
   cd _dev/format-converter
   python api_service.py
   ```

2. **Configure Prometheus** (already configured in centralized monitoring):
   The centralized monitoring at `_dev/monitoring/` is already configured to scrape format-converter on port 8004.

3. **View Grafana Dashboard**:
   - Start centralized monitoring: `cd _dev/monitoring && docker-compose up -d`
   - Access Grafana: http://localhost:3000
   - Navigate to "Format Converter Dashboard"

## API Reference

### FormatConverter

Main converter class.

```python
converter = FormatConverter(
    enable_metrics=True,
    css_path="path/to/style.css"  # Optional default CSS
)

# Convert with auto-detection
result = converter.convert(
    source=content,
    source_format="auto",  # or "markdown", "json", "text"
    target_format="html",  # or "pdf", "markdown", "json"
    css_path="custom.css",  # Optional
    template="template.html",  # Optional
    title="Document Title"  # Optional
)
```

### Supported Conversions

| Source | Target | Status |
|--------|--------|--------|
| Markdown | HTML | ✅ |
| Markdown | PDF | ✅ |
| Markdown | JSON | ✅ (heuristic) |
| JSON | Markdown | ✅ (schema-aware) |
| JSON | HTML | ✅ (via MD) |
| JSON | PDF | ✅ (via MD) |
| HTML | PDF | ✅ |
| Auto-detect | Any | ✅ |

### Format Detection

```python
# Detect format
format = converter.detect_format(content)
# Returns: "markdown", "json", "text", or "unknown"
```

### JSON Extraction

```python
# Extract JSON from LLM response (handles code blocks)
text = """
Here is the data:
```json
{"key": "value"}
```
"""

json_data = converter.extract_json_from_text(text)
# Returns: {"key": "value"} or None
```

### JSON to Markdown (Schema-Aware)

```python
json_data = {
    "report": {
        "title": "Analysis",
        "companies": [
            {"ticker": "AAPL", "market_cap": "3.95T"},
            {"ticker": "NVDA", "market_cap": "4.42T"}
        ]
    }
}

md = converter.json_to_markdown(
    json_data,
    schema=None,  # Optional schema
    title="Stock Analysis"
)
```

### Markdown to JSON

```python
md = """# Title

## Section 1
Content

## Section 2
More content
"""

json_data = converter.markdown_to_json(md)
# Returns structured JSON representation
```

## Advanced Usage

### Custom CSS Styling

```python
converter = FormatConverter(css_path="custom.css")
html = converter.convert(md, target_format="html")
# CSS is automatically injected
```

### HTML Templates

```python
html = converter.convert(
    md,
    target_format="html",
    template="report_template.html",
    title="My Report",
    author="John Doe"
)
```

### PDF Options

```python
pdf_bytes = converter.convert(
    md,
    target_format="pdf",
    css_path="print.css",  # Print-optimized CSS
    title="Report"
)
```

## Development

### Setup

```bash
# Create virtual environment
python3 -m venv .venv
source .venv/bin/activate

# Install in development mode
pip install -e ".[dev]"
```

### Run Tests

```bash
pytest
```

Or use the test runner:

```bash
./run_tests.sh
```

### Run Tests with Coverage

```bash
pytest --cov=format_converter --cov-report=html
```

### Format Code

```bash
black src/
```

### Lint Code

```bash
ruff check src/
```

## Package Structure

```
format-converter/
├── src/
│   ├── format_converter/
│   │   ├── __init__.py
│   │   ├── converter.py              # Main converter
│   │   ├── detector.py               # Format detection
│   │   ├── metrics.py                 # Prometheus metrics
│   │   └── converters/
│   │       ├── markdown_to_html.py
│   │       ├── markdown_to_pdf.py
│   │       ├── json_to_markdown.py
│   │       ├── markdown_to_json.py
│   │       └── json_extractor.py
│   └── tests/
├── examples/
│   ├── basic_usage.py
│   ├── json_conversion.py
│   └── integration_all_modules.py
├── api_service.py                    # FastAPI service
├── pyproject.toml
└── README.md
```

## Dependencies

### Core Dependencies
- `markdown>=3.4.0` - Markdown parsing
- `weasyprint>=60.0` - PDF generation (better CSS support)
- `jinja2>=3.1.0` - Template engine
- `prometheus-client>=0.19.0` - Metrics collection
- `fastapi>=0.104.0` - API framework
- `uvicorn[standard]>=0.24.0` - ASGI server

### Optional Dependencies
- `pydantic>=2.0.0` - Schema validation
- `pypandoc>=1.11` - LaTeX support
- `python-docx>=1.0.0` - DOCX support

## Examples

See `examples/` directory for:
- Basic usage examples
- JSON conversion examples
- Integration with all modules

## License

MIT

